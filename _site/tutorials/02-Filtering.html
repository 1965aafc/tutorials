<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,minimum-scale=1">

  <title>02-Filtering</title>
  <meta name="description" content="Filters">

  <link rel="canonical" href="http://localhost:4000//tutorials/02-Filtering.html">
  <link rel="alternate" type="application/rss+xml" title="VoytekLab Tutorials" href="http://localhost:4000//feed.xml">

  <meta property="og:url"         content="http://localhost:4000//tutorials/02-Filtering.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="02-Filtering" />
<meta property="og:description" content="Filters" />
<meta property="og:image"       content="" />


  <script type="application/ld+json">
  {
  "@context": "http://schema.org",
  "@type": "NewsArticle",
  "mainEntityOfPage":
    "http://localhost:4000//tutorials/02-Filtering.html",
  "headline":
    "02-Filtering",
  "datePublished":
    "2018-10-26T23:55:44-07:00",
  "dateModified":
    "2018-10-26T23:55:44-07:00",
  "description":
    "Filters",
  "author": {
    "@type": "Person",
    "name": "VoytekLab"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Data 100 at UC Berkeley",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:4000/",
      "width": 60,
      "height": 60
    }
  },
  "image": {
    "@type": "ImageObject",
    "url": "http://localhost:4000/",
    "height": 60,
    "width": 60
  }
}

  </script>
  <link rel="stylesheet" href="/assets/css/styles.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css ">
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">

  <!-- <link rel="manifest" href="/manifest.json"> -->
  <!-- <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#efae0a"> -->
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content="/mstile-144x144.png">
  <meta name="theme-color" content="#233947">

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="/images/logo/favicon.ico">

  <!-- MathJax Config -->
  <!-- Allow inline math using $ and automatically break long math lines -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true,
        processEnvironments: true
    },
    CommonHTML: {
        linebreaks: {
            automatic: true,
        },
    },
});
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_CHTML' async></script>

  <!-- DOM updating function -->
  <script>
const runWhenDOMLoaded = cb => {
  if (document.readyState != 'loading') {
    cb()
  } else if (document.addEventListener) {
    document.addEventListener('DOMContentLoaded', cb)
  } else {
    document.attachEvent('onreadystatechange', function() {
      if (document.readyState == 'complete') cb()
    })
  }
}

</script>

  <!-- Include Turbolinks to make page loads fast -->
  <!-- https://github.com/turbolinks/turbolinks -->
  <script src="/assets/js/turbolinks.js" async></script>
  <meta name="turbolinks-cache-control" content="no-cache">

  <!-- Load nbinteract for widgets -->
  <script src="https://unpkg.com/nbinteract-core" async></script>

  <!-- Google analytics -->
  <script src="/assets/js/ga.js" async></script>

  <!-- Clipboard copy button -->
  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" async></script>

  <!-- Load custom website scripts -->
  <script src="/assets/js/scripts.js" async></script>

  <!-- Update interact links w/ REST param, is defined in includes so we can use templates -->
  <script>
/**
  * To auto-embed hub URLs in interact links if given in a RESTful fashion
 */

function getJsonFromUrl(url) {
  var query = url.split('?');
  if (query.length < 2) {
    // No queries so just return false
    return false;
  }
  query = query[1];
  // Collect REST params into a dictionary
  var result = {};
  query.split("&").forEach(function(part) {
    var item = part.split("=");
    result[item[0]] = decodeURIComponent(item[1]);
  });
  return result;
}

// Parse a Binder URL, converting it to the string needed for JupyterHub
function binder2Jupyterhub(url) {
  newUrl = {};
  console.log(url)
  parts = url.split('v2/gh/')[1];
  // Grab the base repo information
  repoinfo = parts.split('?')[0];
  var [org, repo, ref] = repoinfo.split('/');
  newUrl['repo'] = ['https://github.com', org, repo].join('/');
  newUrl['branch'] = ref
  // Grab extra parameters passed
  params = getJsonFromUrl(url);
  if (params['filepath'] !== undefined) {
    newUrl['subPath'] = params['filepath']
  }
  return jQuery.param(newUrl);
}

// Filter out potentially unsafe characters to prevent xss
function safeUrl(url)
{
   return String(encodeURIComponent(url))
            .replace(/&/g, '&amp;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#39;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;');
}

function addParamToInternalLinks(hub) {
  var links = $("a").each(function() {
    var href = this.href;
    // If the link is an internal link...
    if (href.search("http://localhost:4000") !== -1 || href.startsWith('/') || href.search("127.0.0.1:") !== -1) {
      // Assume we're an internal link, add the hub param to it
      var params = getJsonFromUrl(href);
      if (params !== false) {
        // We have REST params, so append a new one
        params['hub'] = hub;
      } else {
        // Create the REST params
        params = {'hub': hub};
      }
      // Update the link
      var newHref = href.split('?')[0] + '?' + jQuery.param(params);
      this.setAttribute('href', decodeURIComponent(newHref));
    }
  });
  return false;
}

// Update interact links
function updateInteractLink() {
    // hack to make this work since it expects a ? in the URL
    rest = getJsonFromUrl("?" + location.search.substr(1));
    hubUrl = rest['hub'];
    if (hubUrl !== undefined) {
      // Sanitize the hubUrl
      hubUrl = safeUrl(hubUrl);
      // Add HTTP text if omitted
      if (hubUrl.indexOf('http') < 0) {hubUrl = 'http://' + hubUrl;}
      link = $("a.interact-button")[0];
      if (link !== undefined) {
          // Update the interact link URL
          var href = link.getAttribute('href');
          var hub_type = 'binder';
          if (hub_type === 'binder') {
            // If binder links exist, we need to re-work them for jupyterhub
            if (hubUrl.indexOf('http%3A%2F%2Flocalhost') > -1) {
              // If localhost, assume we're working from a local Jupyter server and remove `/hub`
              first = [hubUrl, 'git-sync'].join('/')
            } else {
              first = [hubUrl, 'hub', 'user-redirect', 'git-sync'].join('/')
            }
            href = first + '?' + binder2Jupyterhub(href);
          } else {
            // If JupyterHub links, we only need to replace the hub url
            href = href.replace("https://mybinder.org", hubUrl);
            if (hubUrl.indexOf('http%3A%2F%2Flocalhost') > -1) {
              // Assume we're working from a local Jupyter server and remove `/hub`
              href = href.replace("/hub/user-redirect", "");
            }
          }
          link.setAttribute('href', decodeURIComponent(href));

          // Add text after interact link saying where we're launching
          hubUrlNoHttp = decodeURIComponent(hubUrl).replace('http://', '').replace('https://', '');
          $("a.interact-button").after($('<div class="interact-context">on ' + hubUrlNoHttp + '</div>'));

      }
      // Update internal links so we retain the hub url
      addParamToInternalLinks(hubUrl);
    }
}

runWhenDOMLoaded(updateInteractLink)
document.addEventListener('turbolinks:load', updateInteractLink)
</script>
</head>

  <body>
    <!-- Show sidebar by default -->
    <div id="js-textbook" class="c-textbook js-show-sidebar">
      



<nav id="js-sidebar" class="c-textbook__sidebar">
  <img src="/images/logo/logo.png" class="textbook_logo" id="sidebar-logo" data-turbolinks-permanent/>
  <h2 class="c-sidebar__title">VoytekLab Tutorials</h2>
  <ul class="c-sidebar__chapters">
    
      
      

      
      

      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/tutorials/00-Introduction"
        >
          
          Tutorials
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections ">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/tutorials/00-Introduction"
                >
                  
                  00-Introduction
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/tutorials/01-ElectrophysiologicalTimeSeries"
                >
                  
                  01-ElectrophysiologicalTimeSeries
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry c-sidebar__entry--active"
                  href="/tutorials/02-Filtering"
                >
                  
                  02-Filtering
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/tutorials/03-SpectralMethods"
                >
                  
                  03-SpectralMethods
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/tutorials/04-EventRelatedPotentials"
                >
                  
                  04-EventRelatedPotentials
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/tutorials/05-FrequencyInteractions"
                >
                  
                  05-FrequencyInteractions
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/tutorials/06-ColoredNoise"
                >
                  
                  06-ColoredNoise
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/tutorials/07-CommonMisinterpretations"
                >
                  
                  07-CommonMisinterpretations
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/tutorials/08-FrequencyMisinterpretations"
                >
                  
                  08-FrequencyMisinterpretations
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
  </ul>
</nav>


      <main class="c-textbook__page" tabindex="-1">
        <div class="o-wrapper c-sidebar-toggle">
  <!-- We show the sidebar by default so we use .is-active -->
  <button
    id="js-sidebar-toggle"
    class="hamburger hamburger--arrowalt is-active"
  >
    <span class="hamburger-box">
      <span class="hamburger-inner"></span>
    </span>
    <span class="c-sidebar-toggle__label">Toggle Sidebar</span>
  </button>
</div>

        <div class="o-wrapper">
          <!-- INTERACT LINKS -->

    
    
    <div class="buttons">
        <a class="interact-button" href="https://mybinder.org/v2/gh/choldgraf/jupyter-book/master?filepath=content%2Ftutorials%2F02-Filtering.ipynb">Interact</a>
    </div>


          <!-- Shamelessly copied from minimal mistakes -->


<!-- TOC will only show up if it has at least one item -->


  <aside class="sidebar__right">
    <nav class="onthispage">
      <header><h4 class="nav__title"><i class="fa fa-list"></i>   On this page</h4></header>
      <ul class="toc__menu">
  <li><a href="#default-imports">Default Imports</a></li>
</ul>
    </nav>
  </aside>


          <h1 id="filters">Filters</h1>

<p><strong>Michael Tran 2018, Torben Noto 2015</strong></p>

<p>In this notebook, I’m going to provide a broad but shallow overview of how filters basically work. There are many resources available for understanding filtering. This is just an introduction.</p>

<h3 id="default-imports">Default Imports</h3>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#setting settings and loading modules</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="n">sp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">scipy.io</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interactive</span><span class="p">,</span> <span class="n">IntSlider</span><span class="p">,</span> <span class="n">FloatSlider</span><span class="p">,</span> <span class="n">fixed</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
</code></pre></div></div>

<p>So what is a filter and why do we use them?</p>

<p>Filters are rad because they can isolate certain frequency bands in any oscillating signal. Here’s an example:</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#Settings used to generate a signal</span>
<span class="n">f</span> <span class="o">=</span> <span class="mi">1024</span> <span class="c">#sampling frequency</span>
<span class="n">dur</span> <span class="o">=</span> <span class="mi">10</span> <span class="c">#10 seconds of signal</span>
<span class="n">freq</span> <span class="o">=</span> <span class="mi">7</span> <span class="c">#7 Hz signal</span>
<span class="n">freq2</span> <span class="o">=</span> <span class="mi">130</span> <span class="c">#130 Hz signal</span>

<span class="c">#Signal Generation</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dur</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">f</span><span class="p">)</span> <span class="c">#times for d</span>
<span class="n">sig1</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">freq</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="c">#10 Hz wavelength</span>
<span class="n">sig1</span> <span class="o">=</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">sig1</span><span class="p">;</span> <span class="c">#increase the power of signal 1</span>
<span class="n">sig2</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span><span class="n">pi</span> <span class="o">*</span> <span class="n">freq2</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="c">#130 Hz wavelength</span>
<span class="n">complex_signal</span> <span class="o">=</span> <span class="n">sig1</span><span class="o">+</span><span class="n">sig2</span><span class="p">;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">512</span><span class="p">],</span><span class="n">complex_signal</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">512</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'complex signal'</span><span class="p">)</span> <span class="c">#plot 0.5 seconds of data</span>
<span class="n">legend</span><span class="p">()</span>
</code></pre></div></div>

<div class="output_data_text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;matplotlib.legend.Legend at 0x188048a68d0&gt;
</code></pre></div></div>

<p><img src="../images/build/tutorials/02-Filtering_5_1.png" alt="png" /></p>

<p>This signal is composed of two sin waves oscillating at different frequencies, a high-amplitude, slow frequency wave and a low-amplitude, high frequency wave. We can use a <strong>filter</strong> to get just one component of this complex wave and ignore everything else. The filter we will use is known as a Butterworth filter, you can read more about it <a href="https://en.wikipedia.org/wiki/Butterworth_filter">here</a></p>

<p>In the plot below, I used a filter called the Butterworth filter to seperate out the two freqencies present in a complex signal. This could be useful if, for example, that high frequency wave is noise and we’re only interested in the lower frequency one.<br />
There are many types of filters and none of them are perfect. Each filter has advantages and disadvantages and the details of these are important but I won’t cover them here.</p>

<p>A Butterworth filter takes in 3 parameters:</p>
<ul>
  <li>The sampling rate of the data</li>
  <li>A lower bound on the frequency band you want to keep</li>
  <li>An upper bound on the frequency band you want to keep</li>
  <li>An order of the filter. This determines how <em>sharply</em> the filter cuts off bounding frequencies.</li>
</ul>

<p>Below are some functions to allow us to use the Butterworth filter. We will ignore the details of these functions for now as the most important part is not how to create a filter, but to understand why we use them.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">butter_bandpass</span><span class="p">(</span><span class="n">lowcut</span><span class="p">,</span> <span class="n">highcut</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="c">#lowcut is the lower bound of the frequency that we want to isolate</span>
    <span class="c">#hicut is the upper bound of the frequency that we want to isolate</span>
    <span class="c">#fs is the sampling rate of our data</span>
    <span class="n">nyq</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">fs</span> <span class="c">#nyquist frequency - see http://www.dspguide.com/ if you want more info</span>
    <span class="n">low</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">lowcut</span><span class="p">)</span> <span class="o">/</span> <span class="n">nyq</span>
    <span class="n">high</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">highcut</span><span class="p">)</span> <span class="o">/</span> <span class="n">nyq</span>
    <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">butter</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="p">[</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">],</span> <span class="n">btype</span><span class="o">=</span><span class="s">'band'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span>

<span class="k">def</span> <span class="nf">butter_bandpass_filter</span><span class="p">(</span><span class="n">mydata</span><span class="p">,</span> <span class="n">lowcut</span><span class="p">,</span> <span class="n">highcut</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">butter_bandpass</span><span class="p">(</span><span class="n">lowcut</span><span class="p">,</span> <span class="n">highcut</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">filtfilt</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">mydata</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y</span>
</code></pre></div></div>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#Using filters to isolate high and low frequencies</span>
<span class="n">lo_cut</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
<span class="n">hi_cut</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
<span class="n">low_filtered_dat</span> <span class="o">=</span> <span class="n">butter_bandpass_filter</span><span class="p">(</span><span class="n">complex_signal</span><span class="p">,</span><span class="n">lo_cut</span><span class="p">,</span><span class="n">hi_cut</span><span class="p">,</span><span class="mi">1024</span><span class="p">);</span>
<span class="n">lo_cut</span> <span class="o">=</span> <span class="mi">120</span><span class="p">;</span>
<span class="n">hi_cut</span> <span class="o">=</span> <span class="mi">140</span><span class="p">;</span>
<span class="n">hi_filtered_dat</span> <span class="o">=</span> <span class="n">butter_bandpass_filter</span><span class="p">(</span><span class="n">complex_signal</span><span class="p">,</span><span class="n">lo_cut</span><span class="p">,</span><span class="n">hi_cut</span><span class="p">,</span><span class="mi">1024</span><span class="p">);</span>

<span class="c">#Separating our plots</span>
<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">6</span><span class="p">));</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">512</span><span class="p">],</span><span class="n">complex_signal</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">512</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'complex signal'</span><span class="p">)</span> <span class="c">#plot 0.5 seconds of data</span>
<span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">'center left'</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">512</span><span class="p">],</span><span class="n">low_filtered_dat</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">512</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'k'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'low frequency component'</span><span class="p">)</span> <span class="c">#plot 0.5 seconds of low frequency signal</span>
<span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">'center left'</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">512</span><span class="p">],</span><span class="n">hi_filtered_dat</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">512</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'g'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'high frequency component'</span><span class="p">)</span> <span class="c">#plot 0.5 seconds of high frequency signal</span>
<span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">'center left'</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="../images/build/tutorials/02-Filtering_8_0.png" alt="png" /></p>

<p><img src="../images/build/tutorials/02-Filtering_8_1.png" alt="png" /></p>

<p><img src="../images/build/tutorials/02-Filtering_8_2.png" alt="png" /></p>

<p>We have separated our complex signal into two components: the low frequency component and the high frequency component.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#Overlapping our plots for a better visualization</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">512</span><span class="p">],</span><span class="n">complex_signal</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">512</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'complex signal'</span><span class="p">)</span> <span class="c">#plot 0.5 seconds of data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">512</span><span class="p">],</span><span class="n">low_filtered_dat</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">512</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'k'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'low frequency component'</span><span class="p">)</span> <span class="c">#plot 0.5 seconds of low frequency signal</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">512</span><span class="p">],</span><span class="n">hi_filtered_dat</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">512</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'g'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'high frequency component'</span><span class="p">)</span> <span class="c">#plot 0.5 seconds of high frequency signal</span>
<span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">'center left'</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
</code></pre></div></div>

<div class="output_data_text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;matplotlib.legend.Legend at 0x188080f3390&gt;
</code></pre></div></div>

<p><img src="../images/build/tutorials/02-Filtering_10_1.png" alt="png" /></p>

<h1 id="under-construction-below">UNDER CONSTRUCTION BELOW</h1>

<p>If you run this notebook locally, you can use the output of the next cell to play with a filter on some ECoG data to see what kinds of features of the signal that you can pick out in different frequency bands.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filename</span> <span class="o">=</span> <span class="s">'emodat.mat'</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">'./'</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="n">srate</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'srate'</span><span class="p">];</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'data'</span><span class="p">];</span> <span class="c"># time series</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:];</span>
<span class="n">dat</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1024</span><span class="p">];</span>
<span class="k">def</span> <span class="nf">filter_dat</span><span class="p">(</span><span class="n">lo_cut</span><span class="p">,</span><span class="n">hi_cut</span><span class="p">,</span><span class="n">order</span><span class="p">):</span>    

    <span class="n">filtdat</span> <span class="o">=</span> <span class="n">butter_bandpass_filter</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="n">lo_cut</span><span class="p">,</span><span class="n">hi_cut</span><span class="p">,</span><span class="n">srate</span><span class="p">,</span><span class="n">order</span><span class="p">);</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">'blue'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s">'raw data'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">filtdat</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">'black'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">'filtered data'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
    <span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">'center left'</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span>

<span class="n">a_slider</span> <span class="o">=</span> <span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">b_slider</span> <span class="o">=</span> <span class="n">FloatSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">c_slider</span> <span class="o">=</span> <span class="n">FloatSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">w</span><span class="o">=</span><span class="n">interactive</span><span class="p">(</span><span class="n">filter_dat</span><span class="p">,</span><span class="n">lo_cut</span><span class="o">=</span><span class="n">a_slider</span><span class="p">,</span><span class="n">hi_cut</span><span class="o">=</span><span class="n">b_slider</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="n">c_slider</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
</code></pre></div></div>

<div class="output_data_text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>interactive(children=(IntSlider(value=8, description='lo_cut', max=80, min=2), FloatSlider(value=12.0, descrip…
</code></pre></div></div>

<p>So far, I’ve been trying to provide you with an intuition for what a filter can do.</p>

<p>Now we’re going to look at how a simple filter works, mathematically:</p>

<p>The simplest filter is a convolution filter. In this kind of filter, we slide a shape (often called a kernal) along the data. As it passes along the data, each point on the kernal multiplies a point on the data. In the next cell we’ll see what happens if we slide a gaussian distribution (a pretty common filter) along a delta function (zeros with one 1) and some real ECoG data.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">delta_funct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">50</span><span class="p">));</span>
<span class="n">delta_funct</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">delta_funct</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>


<span class="n">dat</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1024</span><span class="p">];</span>

<span class="c">#kernel 1: Gaussian Filter</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="c">#size of filter</span>

<span class="n">mu</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span><span class="p">;</span>
<span class="n">sig</span> <span class="o">=.</span><span class="mi">25</span><span class="p">;</span>  <span class="c">##</span>
<span class="k">def</span> <span class="nf">generate_gaussian_filter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sig</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)));</span>

<span class="n">gaussian_filter</span> <span class="o">=</span> <span class="n">generate_gaussian_filter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sig</span><span class="p">);</span>

<span class="n">convolved_delt</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">delta_funct</span><span class="p">,</span><span class="n">gaussian_filter</span><span class="p">)</span>
<span class="n">convolved_dat</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="n">gaussian_filter</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">delta_funct</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s">'b'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s">'delta function'</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">convolved_delt</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s">'r'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s">'filtered delta'</span><span class="p">)</span>
<span class="n">legend</span><span class="p">()</span>
<span class="n">title</span><span class="p">(</span><span class="s">'Filtering a Delta Function'</span><span class="p">)</span>


<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dat</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s">'b'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s">'raw data'</span><span class="p">)</span> <span class="c">#multiplied by 2 to scale to filtered data</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">convolved_dat</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s">'r'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s">'filtered data'</span><span class="p">)</span>
<span class="n">legend</span><span class="p">()</span>
<span class="n">title</span><span class="p">(</span><span class="s">'Filtering a Delta Function'</span><span class="p">)</span>
</code></pre></div></div>

<div class="output_data_text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Text(0.5,1,'Filtering a Delta Function')
</code></pre></div></div>

<p><img src="../images/build/tutorials/02-Filtering_15_1.png" alt="png" /></p>

<p>Something looks wrong.</p>

<p>Why is the filtered data shifted over to the right in both graphs?</p>

<p>To answer this, let’s look at the filtered delta function.</p>

<p>A convolution is the same as sliding our kernal over the data and multiplying our data by each point in the kernal. As the gaussian filter slid left to right across 0’s each point was multiplied by 0, resulting in nothing. However, when the nose of the gaussian filter reached the 1 in the delta function, it multiplied the leading non-zero value of the gaussian by 1. As we kept pushing the shape through, each point in the filter was multiplied by 1. You’ll see that the length of the vector produced by the convolution is the length of the data + the length of the filter - 1. This happened beacuse had to multiply each point in the data by both the nose and the tail of the kernal, resulting in some extra points. Because we simply multiplied each point in the kernal by 1, convolving a delta function with any filter will perfectly reproduce the kernal.</p>

<p>What if we don’t want our filtered data to be shifted? And how come the filtered data a few cells above isn’t shifted?</p>

<p>In the next cell I’ll show you some simple ways to get rid of this shift.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dat</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1024</span><span class="p">];</span>

<span class="c">#time lag resistant kernel #1: Causal Filter (exponential filter)</span>
<span class="c">#filter parameters</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="c">#size of filter</span>
<span class="n">tau</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span><span class="p">;</span>
<span class="n">amp_reduct</span> <span class="o">=</span> <span class="o">.</span><span class="mi">1</span><span class="p">;</span>
<span class="k">def</span> <span class="nf">generate_causal_filter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">tau</span><span class="p">,</span><span class="n">amp_reduct</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">amp_reduct</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">tau</span><span class="p">)));</span>

<span class="n">causal_filter</span> <span class="o">=</span> <span class="n">generate_causal_filter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">tau</span><span class="p">,</span><span class="n">amp_reduct</span><span class="p">);</span>
<span class="n">delta_funct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">100</span><span class="p">));</span>
<span class="n">delta_funct</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">delta_funct</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="n">convolved_delt_causal_filt</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">delta_funct</span><span class="p">,</span><span class="n">causal_filter</span><span class="p">)</span>
<span class="n">convolved_dat_causal_filt</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="n">causal_filter</span><span class="p">)</span>


<span class="c">#time lag resistant kernel #2: Two-way Filter</span>
<span class="n">convolved_delt_two_way</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">delta_funct</span><span class="p">,</span><span class="n">gaussian_filter</span><span class="p">)</span>
<span class="n">convolved_delt_two_way</span> <span class="o">=</span> <span class="n">convolved_delt_two_way</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">delta_funct</span><span class="p">)]</span>
<span class="n">convolved_delt_two_way</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">convolved_delt_two_way</span><span class="p">)),</span><span class="n">gaussian_filter</span><span class="p">)</span>
<span class="n">convolved_delt_two_way</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">convolved_delt_two_way</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">delta_funct</span><span class="p">)]))</span>

<span class="n">convolved_dat_two_way</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="n">gaussian_filter</span><span class="p">)</span>
<span class="n">convolved_dat_two_way</span> <span class="o">=</span> <span class="n">convolved_dat_two_way</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">)]</span>
<span class="n">convolved_dat_two_way</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">convolved_dat_two_way</span><span class="p">)),</span><span class="n">gaussian_filter</span><span class="p">)</span>
<span class="n">convolved_dat_two_way</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">convolved_dat_two_way</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">)]))</span>

<span class="c">#plotting</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">delta_funct</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s">'b'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s">'delta function'</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">convolved_delt_causal_filt</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s">'r'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s">'filtered delta'</span><span class="p">)</span>
<span class="n">legend</span><span class="p">()</span>
<span class="n">title</span><span class="p">(</span><span class="s">'Filtering a delta function with a causal filter'</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dat</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s">'b'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s">'raw data'</span><span class="p">)</span> <span class="c">#multiplied by 2 to scale to filtered data</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">convolved_dat_causal_filt</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s">'r'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s">'filtered data'</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s">'Filtering data with a causal filter'</span><span class="p">)</span>
<span class="n">legend</span><span class="p">()</span>

<span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">delta_funct</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s">'b'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s">'delta function'</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">convolved_delt_two_way</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s">'r'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s">'filtered delta'</span><span class="p">)</span>
<span class="n">legend</span><span class="p">()</span>
<span class="n">title</span><span class="p">(</span><span class="s">'Filtering a delta function with a two-way filter'</span><span class="p">)</span>

<span class="n">ax4</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dat</span><span class="o">*</span><span class="mi">50</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s">'b'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s">'raw data'</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">convolved_dat_two_way</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'r'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'Filtering data with a two-way filter'</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s">'Filtering data with a two-way filter'</span><span class="p">)</span>
<span class="n">legend</span><span class="p">()</span>

</code></pre></div></div>

<div class="output_data_text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;matplotlib.legend.Legend at 0x1fd681f9198&gt;
</code></pre></div></div>

<p><img src="../images/build/tutorials/02-Filtering_17_1.png" alt="png" /></p>

<p>One way of getting rid of dealing with time lag is to have a filter with no leading tail like we do here with a causal filter.</p>

<p>Another way is to perform a convolution on the data with a filter kernal, then convolve the convolved data again, backwards. This works because convolving the convolved data backwards reverses any time lag, exactly. This is what the sp.signal.filtfilt method in one of the first cells does. Try replacing sp.signal.filtfilt with sp.signal.lfilter and you’ll see the time lag occur.</p>

<p>There are many, many filtering methods and these are just a few simple ones. There is no such thing as a perfect filter. Some filtering methods are better for certain uses and picking the best one takes some expertise.</p>

<p>What we learned:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Filters help us see what is going on in different frequency ranges in data
You can apply a filter to data in just a few lines of code
Filters work by convolving a shape with your data, the same as multiplying everything on a sliding window
Time delay in filtering is a problem that can be solved.
</code></pre></div></div>



          <nav class="c-page__nav">
  
    <a id="js-page__nav__prev" class="c-page__nav__prev" href="/tutorials/01-ElectrophysiologicalTimeSeries">
      〈 <span class="u-margin-right-tiny"></span> 01-ElectrophysiologicalTimeSeries
    </a>
  

  
    <a id="js-page__nav__next" class="c-page__nav__next" href="/tutorials/03-SpectralMethods">
      03-SpectralMethods <span class="u-margin-right-tiny"></span> 〉
    </a>
  
</nav>

        </div>
      </main>
    </div>

  </body>
</html>
